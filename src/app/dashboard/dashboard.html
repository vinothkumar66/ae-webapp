<div class="dashboard-toolbar">
   <dx-select-box
    [items]="dashboardNames"
    placeholder="Select Dashboard"
    displayExpr="pagename"
    valueExpr="pageid"
    [(value)]="selectedDashboardId"
    (onValueChanged)="onTypeChanged($event)"
    stylingMode="outlined">
  </dx-select-box>

  <dx-button *ngIf="!isViewerMode && !isUpdateMode" icon="save" text="Save" hint="Save Dashboard" stylingMode="contained" type="default" (onClick)="openSavePopup()"></dx-button>

  <dx-button *ngIf="!isViewerMode && isUpdateMode" text="Update" icon="refresh" type="success" (onClick)="updatePage()"></dx-button>

  <dx-button *ngIf="!isViewerMode" icon="add" text="New Dashboard" hint="New Dashboard" stylingMode="outlined" type="danger" (onClick)="clearDashboard()"></dx-button>

  <dx-button *ngIf="!isViewerMode" icon="eyeopen" text="Viewer" hint="Switch to Viewer" stylingMode="text" (onClick)="toggleViewerMode()"></dx-button>

  <dx-button *ngIf="!isViewerMode" icon="plus" text="Add Chart" hint="Add Chart" stylingMode="contained" type="success" (onClick)="goToAddChart()"></dx-button>

  <dx-button *ngIf="isViewerMode" icon="edit" text="Designer" hint="Switch to Designer" stylingMode="contained" (onClick)="toggleViewerMode()"></dx-button>
</div>

<div class="dashboard-container">
  <div *ngIf="!dashboardItems.length && isViewerMode" class="no-dashboard">
    No Dashboard Available
  </div>

  <div class="main-content" (drop)="dropChart($event)" (dragover)="allowDrop($event)">
    <div *ngIf="dashboardHeader" class="dashboard-header">
      <ng-container *ngIf="!isViewerMode; else viewHeader">
        <input [(ngModel)]="dashboardHeader.text" class="header-input" placeholder="Enter dashboard title..." />
      </ng-container>
      <ng-template #viewHeader> 
        <h2 class="header-title">{{ dashboardHeader.text }}</h2>
      </ng-template> 
    </div> 

    <div *ngFor="let row of dashboardItems; let i = index" class="row-widget">
      <div 
        *ngIf="!isViewerMode" 
        class="row-drag-handle"
        draggable="true"
        (dragstart)="startRowDrag($event, i)"
        (drop)="dropRow($event, i)"
        (dragover)="rowDragOver($event)"
        (dragleave)="rowDragLeave($event)"
      >
        <i class="dx-icon dx-icon-dragvertical drag-icon"></i>
        <button class="delete-row-btn" (click)="deleteRow(i)">
          <i class="dx-icon dx-icon-close close-icon"></i>
        </button>
      </div>

      <ng-container *ngIf="row.columns.length === 0 && !isViewerMode">
        <div class="row-placeholder" (drop)="dropChart($event, row)" (dragover)="allowDrop($event)">
          Drop columns here
        </div>
      </ng-container>

      <ng-container *ngIf="row.columns.length > 0">
        <gridster [options]="row.gridsterOptions">
          <gridster-item *ngFor="let col of row.columns; let j = index" [item]="col">
            <div class="col-widget" (drop)="dropChart($event, row, col)" (dragover)="allowDrop($event)">
              <ng-container *ngIf="col.chartTitle || col.cards; else emptyCol">
                <div class="chart-widget">
                  <div class="chart-header">
                    <ng-container *ngIf="col.chartTitle; else emptyTitle">
                      <span class="chart-title">{{ col.chartTitle?.pagename}}</span>
                    </ng-container>
                    <ng-template #emptyTitle>
                      <span class="chart-title">Card</span>
                    </ng-template>
                    <button *ngIf="!isViewerMode" class="delete-chart-btn" (click)="deleteCol(row, j)">
                      <i class="dx-icon dx-icon-close"></i>
                    </button>
                  </div>

                  <div class="chart-content">
                    <div class="cards" *ngIf="!col.chartState.showId">
                      <ng-container *ngFor="let card of col.cards">
                        <div *ngIf="card.type === 'card'" class="card">
                          <div class="card-value">{{ card.value }}</div>
                          <div class="card-label">{{ card.label }}</div>
                        </div>
                      </ng-container>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 73">
                      <dx-chart
                        [dataSource]="col.chartState.AlmChartData"
                        [valueAxis]="col.chartState.valueAxisConfig"
                        [argumentAxis]="{ argumentType: 'string', title: 'Area', discreteAxisDivisionMode: 'crossLabels' }"
                      >
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                        <dxi-series
                          *ngFor="let s of col.chartState.seriesData"
                          [valueField]="s.valueField"
                          argumentField="Area"
                          [name]="s.name"
                          type="bar"
                          [color]="s.color"
                        ></dxi-series>
                      </dx-chart>
                    </div>

                    <div class="chart-body AlmDash" *ngIf="col.chartState.showId == 64">
                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.AlmDashboardData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                        width="100%"
                      >
                        <dxo-paging [enabled]="false"></dxo-paging>
                        <dxi-column dataField="Area" caption="Area" cssClass="center-header"></dxi-column>
                        <dxi-column caption="DAET" dataField="DAET_Count" cssClass="center-header">
                          <ng-template let-data="data" dxTemplate="cell">
                            <span>
                              <dx-button icon="preferences"></dx-button>
                              {{ data.DAET_Count }}
                            </span>
                          </ng-template>
                        </dxi-column>
                        <dxi-column dataField="AFM_Count" caption="AFM" cssClass="center-header"></dxi-column>
                      </dx-data-grid>

                      <div class="AlmDash-main">
                        <div class="AlmDash-Content">
                          <div>AFM: Alarm Flood Metric</div><br>
                          <span>Number of hours in the month that had any periods exceeding 10 alarms in 10 minutes.</span>
                        </div>
                        <div class="AlmDash-Content">
                          <div>DAET: Days Alarms Exceed Target</div><br>
                          <span>Number of days in the month that exceeded 300 alarms.</span>
                        </div>
                      </div>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 52 || col.chartState.showId == 54 || col.chartState.showId == 53">
                      <dx-chart
                        [dataSource]="col.chartState.AlmsPerOprPositionData"
                        [argumentAxis]="{ argumentType: 'string', title: 'Datetime', discreteAxisDivisionMode: 'crossLabels' }"
                       
                        [valueAxis]="col.chartState.valueAxisConfig ? col.chartState.valueAxisConfig : undefined"
                      >
                        <dxi-series
                          *ngFor="let series of col.chartState.seriesData"
                          [valueField]="series.valueField"
                          [argumentField]="series.argumentField"
                          [name]="series.name"
                          type="bar"
                          [color]="series.color"
                        ></dxi-series>
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.AlmsPerOprPositionTableData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                       
                      >
                        
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 55 || col.chartState.showId == 56">
                      <div class="chart-container" *ngIf="col.chartState.showChartOnly">
                        <dx-chart [dataSource]="col.chartState.chartData">
                          <dxo-legend [visible]="false"></dxo-legend>
                          <dxi-series *ngFor="let series of col.chartState.chartSeries"
                            [type]="series.type"
                            [argumentField]="series.argumentField"
                            [valueField]="series.valueField"
                            [name]="series.name">
                          </dxi-series>
                          <dxi-value-axis *ngFor="let axis of col.chartState.chartAxis"
                            [position]="axis.position"
                            [title]="axis.title"
                            [showZero]="axis.showZero"
                            [tickInterval]="axis.tickInterval"
                            [valueMarginsEnabled]="axis.valueMarginsEnabled"
                            [constantLines]="axis.constantLines">
                          </dxi-value-axis>
                        </dx-chart>
                      </div>

                      <div class="table-container" *ngIf="col.chartState.showTableOnly">
                        <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.tableData" [showBorders]="true" [rowAlternationEnabled]="true">
                          <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                          <dxo-paging [enabled]="true" [pageSize]="5"></dxo-paging>
                          <dxo-search-panel [visible]="true" [highlightCaseSensitive]="true"></dxo-search-panel>
                          <dxi-column *ngFor="let column of col.chartState.tableColumns" [dataField]="column"></dxi-column>
                        </dx-data-grid>
                      </div>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 62">
                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.eeumaData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                        [export]="{ enabled: false }"
                      >
                        <dxo-scrolling columnRenderingMode="virtual"></dxo-scrolling>
                        <dxo-paging [enabled]="false"></dxo-paging>
                        <dxi-column dataField="Metric" caption="Metric" width="500" cssClass="center-header"></dxi-column>
                        <dxi-column caption="Target" cssClass="center-header">
                          <dxi-column dataField="Col1" caption="Min" cssClass="center-header"></dxi-column>
                          <dxi-column dataField="Col2" caption="Max" cssClass="center-header"></dxi-column>
                        </dxi-column>
                        <dxi-column dataField="Col3" caption="Value" cssClass="center-header"></dxi-column>
                      </dx-data-grid>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.eeumacalcu"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                        class="eeumacalcu"
                      >
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 63">
                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.iecData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                       
                        (onCellPrepared)="onCellPrepared($event)"
                      >
                        <dxo-paging [enabled]="false"></dxo-paging>
                        <dxi-column caption="Alarms Performance Metrics" cssClass="center-header">
                          <dxi-column dataField="Metric" caption="Metric" cssClass="center-header"></dxi-column>
                          <dxi-column caption="Target" cssClass="center-header">
                            <dxi-column dataField="Target1" caption="Target 1" cssClass="table-hidden center-header"></dxi-column>
                            <dxi-column dataField="Target2" caption="Target 2" cssClass="table-hidden center-header"></dxi-column>
                          </dxi-column>
                          <dxi-column dataField="Col1" caption="Value" cssClass="center-header" width="150"></dxi-column>
                        </dxi-column>
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 61">
                      <dx-chart
                        [dataSource]="col.chartState.AlarmVsOperatorData[0]?.data"
                        *ngIf="col.chartState.showChartOnly"
                        [rotated]="false"
                      >
                        <dxo-legend [visible]="false"></dxo-legend>
                        <dxi-pane *ngFor="let pane of col.chartState.AlarmVsOperatorData[0]?.pane" [name]="pane.name"></dxi-pane>
                        <dxi-series
                          *ngFor="let series of col.chartState.AlarmVsOperatorData[0]?.series"
                          [type]="series.type"
                          [valueField]="series.valueField"
                          [argumentField]="series.argumentField"
                          [name]="series.name"
                          [pane]="series.pane"
                        ></dxi-series>

                        <dxi-value-axis *ngFor="let axis of col.chartState.AlarmVsOperatorData[0]?.axis"
                          [position]="axis.position"
                          [pane]="axis.pane"
                          [tickInterval]="axis.tickInterval"
                          [valueMarginsEnabled]="axis.valueMarginsEnabled"
                          [showZero]="axis.showZero"
                        >
                          <dxo-title [text]="axis.title.text"></dxo-title>
                        </dxi-value-axis>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.AlarmVsOperatorTableData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                        *ngIf="col.chartState.showTableOnly"
                      >
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 72 || col.chartState.showId == 50">
                      <dx-chart [dataSource]="col.chartState.ChatteringData[0]?.data" *ngIf="col.chartState.showChartOnly">
                        <dxo-legend [visible]="false"></dxo-legend>
                      </dx-chart>
                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200"
                        [dataSource]="col.chartState.ChatteringTableData"
                        [showBorders]="true"
                        [cellHintEnabled]="true"
                        [rowAlternationEnabled]="true"
                        *ngIf="col.chartState.showTableOnly"
                       >
                        
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 51">
                      <dx-chart [dataSource]="col.chartState.FleedingData[0]?.data" *ngIf="col.chartState.showChartOnly">
                        <dxi-series *ngFor="let s of col.chartState.FleedingData[0]?.series"
                          [type]="s.type"
                          [argumentField]="s.argumentField"
                          [valueField]="s.valueField"
                          [name]="s.name"
                          [axis]="s.axis">
                        </dxi-series>
                        <dxi-value-axis *ngFor="let a of col.chartState.FleedingData[0]?.axis"
                          [position]="a.position"
                          [name]="a.name"
                          [showZero]="a.showZero"
                          [tickInterval]="a.tickInterval"
                          [valueMarginsEnabled]="a.valueMarginsEnabled">
                          <dxo-title [text]="a.title.text"></dxo-title>
                        </dxi-value-axis>
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.FleedingTableData" [showBorders]="true" [cellHintEnabled]="true" [rowAlternationEnabled]="true" *ngIf="col.chartState.showTableOnly">
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == 60 || col.chartState.showId == 48 || col.chartState.showId == 49 || col.chartState.showId == 67">
                      <dx-chart *ngIf="col.chartState.FloodData.length && col.chartState.showChartOnly" [dataSource]="col.chartState.FloodData[0]?.data">
                        <dxi-series *ngFor="let s of col.chartState.FloodData[0]?.series"
                          [type]="s.type" [argumentField]="s.argumentField" [valueField]="s.valueField" [name]="s.name"></dxi-series>
                        <dxo-value-axis>
                          <dxo-title [text]="col.chartState.FloodData[0]?.axis[0]?.title?.text"></dxo-title>
                          <dxi-constant-line *ngFor="let line of col.chartState.FloodData[0]?.axis[0]?.constantLines"
                            [value]="line.value" [color]="line.color" [width]="line.width" [dashStyle]="line.dashStyle">
                            <dxo-label [visible]="line.label.visible" [position]="line.label.position" [text]="line.label.text">
                              <dxo-font [color]="line.label.font.color" [weight]="line.label.font.weight" [size]="line.label.font.size"></dxo-font>
                            </dxo-label>
                          </dxi-constant-line>
                        </dxo-value-axis>
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.FloodTableData" [showBorders]="true" [cellHintEnabled]="true" [rowAlternationEnabled]="true"
                      *ngIf="col.chartState.showTableOnly">
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                      <div class="chart-body" *ngIf="col.chartState.showId == '74'">
                      <div id="">
                        <div class="barchart">
                          <div class="row">
                            <div class="col">
                              <dx-chart
                                title="Alarm Performance Indication Overtime Steady State"
                                [dataSource]="alarm_metrics_barchart"
                                [customizePoint]="customizeBarchartPoint"
                              >
                              <ng-container *ngIf="alarm_metrics_barchart && alarm_metrics_barchart.length">
                                <ng-container *ngFor="let area of getUniqueAreas(alarm_metrics_barchart)">
                                  <dxi-series valueField="{{ area }}" name="{{ area }}" color="{{ getColor(area) }}"></dxi-series>
                                </ng-container>
                              </ng-container>
                              
                                <dxo-common-series-settings
                                  argumentField="date"
                                  type="bar"
                                  [barWidth]="45"
                                >
                                </dxo-common-series-settings>
                                <dxo-tooltip
                                  [enabled]="true"
                                  [customizeTooltip]="customizebarchartTooltip"
                                ></dxo-tooltip>
                                <dxo-margin [bottom]="20"></dxo-margin>
                                <dxi-value-axis [wholeRange]="[0, 16]"
                                [tickInterval]="3.5">
                                  <dxo-label
                                    [customizeText]="customizeText1"
                                  ></dxo-label>
                                </dxi-value-axis>
                                <dxo-argument-axis>
                                  <dxo-grid [visible]="true"></dxo-grid>
                                </dxo-argument-axis>
                                <dxo-legend
                                  verticalAlignment="bottom"
                                  horizontalAlignment="center"
                                >
                                </dxo-legend>
                              </dx-chart>
                            </div>
                            <div class="col">
                              <dx-chart
                                title="Alarm Performance Indication Overtime Upset State"
                                [dataSource]="
                                  alarm_metrics_barchart_upset_state
                                "
                                [customizePoint]="customizeBarchartPoint"
                              >
                              <ng-container *ngIf="alarm_metrics_barchart_upset_state && alarm_metrics_barchart_upset_state.length">
                                <ng-container *ngFor="let area of getUniqueAreas(alarm_metrics_barchart_upset_state)">
                                  <dxi-series valueField="{{ area }}" name="{{ area }}" color="{{ getColor2(area) }}"></dxi-series>
                                </ng-container>
                              </ng-container>

                                <dxo-common-series-settings
                                  argumentField="date"
                                  type="bar"
                                  [barWidth]="45"
                                >
                                </dxo-common-series-settings>
                                <dxo-tooltip
                                  [enabled]="true"
                                  [customizeTooltip]="customizebarchartTooltip"
                                ></dxo-tooltip>
                                <dxo-margin [bottom]="20"></dxo-margin>
                                <dxi-value-axis  [wholeRange]="[0, 16]"
                                [tickInterval]="3.5">
                                  <dxo-label
                                    [customizeText]="customizeText1"
                                  ></dxo-label>
                                </dxi-value-axis>
                                <dxo-argument-axis>
                                  <dxo-grid [visible]="true"></dxo-grid>
                                </dxo-argument-axis>
                                <dxo-legend
                                  verticalAlignment="bottom"
                                  horizontalAlignment="center"
                                >
                                </dxo-legend>
                              </dx-chart>
                            </div>
                          </div>
                        </div>

                        <div class="areachart">
                          <div class="row">
                            <div class="col">
                              <dx-chart
                                title="Steady State Alarm Performance"
                                [dataSource]="alarm_metrics1"
                                [customizePoint]="customizePoint"
                              >
                                <dxi-series
                                  valueField="overload"
                                  name="overload"
                                  color="red"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="reactive"
                                  name="reactive"
                                  color="#fdec30"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="stable"
                                  name="stable"
                                  color="#c1e887"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="robust"
                                  name="robust"
                                  color="#187233"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                valueField="state_percent_outside_target_avg_value"
                                argumentField="state_avg"
                                name="Steady_State_Scatter_series"
                                type="scatter"
                              >
                                <dxo-point
                                  ><dxo-image
                                    url="../../assets/s_images.png"
                                  ></dxo-image
                                ></dxo-point>
                              </dxi-series>
                              <dxi-series
                                valueField="percent_outside_target_avg_value"
                                name="Scatter_Series"
                                argumentField="avg"
                                type="scatter"
                              >
                                <dxo-point [size]="7">
                                  <dxo-border
                                    [visible]="true"
                                    color="black"
                                  ></dxo-border>
                                </dxo-point>
                              </dxi-series>

                              <dxo-tooltip
                                  [enabled]="true"
                                  location="edge"
                                  [customizeTooltip]="customizeTooltip"
                                >
                                </dxo-tooltip>

                                <dxo-common-series-settings
                                  #commonSeries
                                  type="area"
                                >
                                  <dxo-hover-style>
                                    <dxo-hatching
                                      direction="none"
                                    ></dxo-hatching>
                                  </dxo-hover-style>
                                </dxo-common-series-settings>
                                <dxi-value-axis
                                  [wholeRange]="[0, 80]"
                                  [valueMarginsEnabled]="false"
                                >
                                  <dxo-label
                                    [customizeText]="
                                      customizeTextAreaChartSteadyStateVal
                                    "
                                  ></dxo-label>
                                  <dxo-title text="%Timeout Above Target Value (<10)"></dxo-title>
                                </dxi-value-axis>
                                <dxo-argument-axis
                                  [valueMarginsEnabled]="false"
                                  [wholeRange]="[0, 80]"
                                  [tickInterval]="20"
                                >
                                  <dxo-grid [visible]="true"></dxo-grid>
                                  <dxo-label
                                    [customizeText]="
                                      customizeTextAreaChartSteadyStateArg
                                    "
                                  ></dxo-label>
                                  <dxo-title text="Average Alarm Rate"></dxo-title>
                                </dxo-argument-axis>

                                <dxo-legend
                                  verticalAlignment="top"
                                  horizontalAlignment="right"
                                  [visible]="true"
                                  [customizeItems]="customLegendItems"
                                >
                                </dxo-legend>
                              </dx-chart>
                            </div>
                            <div class="col">
                              <dx-chart
                                title="Upset State Alarm Performance"
                                [dataSource]="alarm_metrics2"
                                [customizePoint]="customizePoint"
                              >
                                <dxi-series
                                  valueField="overload"
                                  name="overload"
                                  color="#ec1834"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="reactive"
                                  name="reactive"
                                  color="#fdec30"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="stable"
                                  name="stable"
                                  color="#c1e887"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                  valueField="robust"
                                  name="robust"
                                  color="#187233"
                                  argumentField="state"
                                ></dxi-series>
                                <dxi-series
                                valueField="state_percent_outside_target"
                                argumentField="state_max"
                                name="Upset_State_Scatter_series"
                                type="scatter"
                              >
                                <dxo-point
                                  ><dxo-image
                                    url="../../assets/u_image.png"
                                  ></dxo-image
                                ></dxo-point>
                              </dxi-series>
                                <dxi-series
                                  valueField="percent_outside_target"
                                  name="Scatter_Series"
                                  argumentField="max"
                                  type="scatter"
                                >
                                  <dxo-point [size]="7">
                                    <dxo-border
                                      [visible]="true"
                                      color="black"
                                    ></dxo-border>
                                  </dxo-point>
                                </dxi-series>
                          
                                <dxo-tooltip
                                  [enabled]="true"
                                  location="edge"
                                  [customizeTooltip]="customizeTooltipUpsetState"
                                >
                                </dxo-tooltip>
                                <dxo-common-series-settings
                                  #commonSeries
                                  type="area"
                                >
                                  <dxo-hover-style>
                                    <dxo-hatching
                                      direction="none"
                                    ></dxo-hatching>
                                  </dxo-hover-style>
                                </dxo-common-series-settings>
                                <dxi-value-axis
                                  [wholeRange]="[0, 80]"
                                  [valueMarginsEnabled]="false"
                                >
                                  <dxo-label
                                    [customizeText]="
                                      customizeTextAreaChartUpsetVal
                                    "
                                  ></dxo-label>
                                  <dxo-title text="%Timeout Above Target Value (>10)"></dxo-title>
                                </dxi-value-axis>
                                <dxo-argument-axis
                                  [valueMarginsEnabled]="false"
                                  [wholeRange]="[0, 40]"
                                  [tickInterval]="10"
                                >
                                  <dxo-grid [visible]="true"></dxo-grid>
                                  <dxo-label
                                    [customizeText]="
                                      customizeTextAreaChartUpsetArg
                                    "
                                  ></dxo-label>
                                  <dxo-title text="Max Alarm Rate"></dxo-title>
                                </dxo-argument-axis>

                                <dxo-legend
                                  verticalAlignment="top"
                                  horizontalAlignment="right"
                                  [visible]="true"
                                  [customizeItems]="customLegendItems"
                                >
                                </dxo-legend>
                              </dx-chart>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId == '75'">
                      <div class="dx-viewport">
                          <div class="kpicharts">
                            <ng-container
                              *ngFor="let dataset of productionData"
                            >

                            <dx-polar-chart
                                id="polar-chart"
                                class="polar_chart"
                                [dataSource]="dataset.data"
                              >
                              <dxo-title [text]="dataset.area" [subtitle]="dataset.date">
                                <dxo-font size="small" color="black"></dxo-font>
                              </dxo-title>
                                <dxo-value-axis [visualRange]="[0, 95]">
                                  <dxi-strip
                                    [startValue]="0"
                                    [endValue]="20"
                                    color="lightgreen"
                                  ></dxi-strip>
                                  <dxi-strip
                                    [startValue]="20"
                                    [endValue]="40"
                                    color="yellow"
                                  ></dxi-strip>
                                  <dxi-strip
                                    [startValue]="40"
                                    [endValue]="60"
                                    color="skyblue"
                                  ></dxi-strip>
                                  <dxi-strip
                                    [startValue]="60"
                                    [endValue]="80"
                                    color="orange"
                                  ></dxi-strip>
                                  <dxi-strip
                                    [startValue]="80"
                                    [endValue]="100"
                                    color="pink"
                                  ></dxi-strip>
                                </dxo-value-axis>

                                <dxo-legend [visible]="false"></dxo-legend>
                                <dxi-series
                                  valueField="val1"
                                  color="#ba4d51"
                                ></dxi-series>

                                <dxo-common-series-settings
                                  #seriesSettings
                                  type="line"
                                ></dxo-common-series-settings>
                                <dxo-tooltip [enabled]="true"></dxo-tooltip>
                                <dxo-common-axis-settings>
                                  <dxo-tick [visible]="true" color="black"></dxo-tick>
                              </dxo-common-axis-settings>
                              </dx-polar-chart>
                            </ng-container>
                          </div>
                        </div>
                    </div>

                    <div class="chart-body" *ngIf="col.chartState.showId && (col.chartState.showId == '26' || col.chartState.showId == '30' || col.chartState.showId == '29' || col.chartState.showId == '27' || col.chartState.showId == '28' || col.chartState.showId == '1' || col.chartState.showId == '12' || col.chartState.showId == '9' || col.chartState.showId == '8' || col.chartState.showId == '5' || col.chartState.showId == '2' || col.chartState.showId == '11' || col.chartState.showId == '10' || col.chartState.showId == '6' || col.chartState.showId == '4' || col.chartState.showId == '7' || col.chartState.showId == '3' || col.chartState.showId == '33' || col.chartState.showId == '31' || col.chartState.showId == '76' || col.chartState.showId == '21' || col.chartState.showId == '18' || col.chartState.showId == '25' || col.chartState.showId == '24' || col.chartState.showId == '13' || col.chartState.showId == '14' || col.chartState.showId == '16' || col.chartState.showId == '17' || col.chartState.showId == '22' || col.chartState.showId == '15' || col.chartState.showId == '19' || col.chartState.showId == '20' || col.chartState.showId == '23' || col.chartState.showId == '32' || col.chartState.showId == '57' || col.chartState.showId == '58')">
                      <dx-chart [dataSource]="col.chartState.FrequencyData[0]?.data" *ngIf="col.chartState.showChartOnly">
                        <dxo-common-series-settings argumentField="tagno.parameter"></dxo-common-series-settings>
                        <dxi-series *ngFor="let series of col.chartState.FrequencyData[0]?.series"
                          [type]="series.type" [valueField]="series.valueField" [name]="series.name" [axis]="series.axis"></dxi-series>
                        <dxi-value-axis *ngFor="let ax of col.chartState.FrequencyData[0]?.axis"
                          [name]="ax.name" [position]="ax.position" [showZero]="ax.showZero" [tickInterval]="ax.tickInterval" [valueMarginsEnabled]="ax.valueMarginsEnabled">
                          <dxo-title [text]="ax.title.text"></dxo-title>
                        </dxi-value-axis>
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.FrequencyTableData" [showBorders]="true" [cellHintEnabled]="true" [rowAlternationEnabled]="true" *ngIf="col.chartState.showTableOnly">
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <!-- SOE -->
                    <div class="chart-body" *ngIf="col.chartState.showId == 77 || col.chartState.showId == 47 || col.chartState.showId == 45">
                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.SOETableData" [showBorders]="true" [cellHintEnabled]="true" [rowAlternationEnabled]="true">
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>

                    <!-- StandingACK -->
                    <div class="chart-body" *ngIf="col.chartState.showId && (col.chartState.showId == '46' || col.chartState.showId == '34' || col.chartState.showId == '35' || col.chartState.showId == '38' || col.chartState.showId == '39' || col.chartState.showId == '37' || col.chartState.showId == '36' || col.chartState.showId == '43' || col.chartState.showId == '44' || col.chartState.showId == '42' || col.chartState.showId == '41' || col.chartState.showId == '40')">
                      <dx-chart *ngIf="col.chartState.StandingACKData.length && col.chartState.showChartOnly" [dataSource]="col.chartState.StandingACKData[0]?.data">
                        <dxi-series *ngFor="let s of col.chartState.StandingACKData[0]?.series"
                          [type]="s.type" [argumentField]="s.argumentField" [valueField]="s.valueField" [name]="s.name"></dxi-series>
                        <dxo-legend verticalAlignment="top" horizontalAlignment="center"></dxo-legend>
                      </dx-chart>

                      <dx-data-grid [remoteOperations]="true" [columnWidth]="200" [dataSource]="col.chartState.StandingACKTableData" 
                      *ngIf="col.chartState.showTableOnly" [showBorders]="true" [cellHintEnabled]="true" [rowAlternationEnabled]="true">
                        <dxo-scrolling mode="virtual" rowRenderingMode="virtual"></dxo-scrolling>
                        <dxo-header-filter [visible]="true">
                          <dxo-search [enabled]="true"></dxo-search>
                        </dxo-header-filter>
                      </dx-data-grid>
                    </div>
                  </div>
                </div>
              </ng-container>

              <ng-template #emptyCol>
                <div *ngIf="!isViewerMode" class="empty-col-placeholder">Drop chart here</div>
              </ng-template>
            </div>
          </gridster-item>
        </gridster>
      </ng-container>

      <div *ngIf="!isViewerMode" class="row-resize-handle" (mousedown)="startRowResize($event, row, i)"></div>
    </div>
  </div>

  <div class="right-sidebar" *ngIf="!isViewerMode">
    <div class="tab-header">
      <div
        class="tab-button"
        [class.active]="activeTab === 'controls'"
        (click)="activeTab = 'controls'"
      >
        Controls
      </div>
      <div
        class="tab-button"
        [class.active]="activeTab === 'layout'"
        (click)="activeTab = 'layout'"
      >
        Layout Options
      </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'controls'">
      <div
        *ngFor="let chart of availableCharts"
        class="control-chart-item"
        draggable="true"
        (dragstart)="startDrag(chart, $event)"
      >
        {{ chart.pagename }}
      </div>
    </div>

    <div class="tab-content" *ngIf="activeTab === 'layout'">
      <div
        *ngFor="let layout of availableLayouts"
        class="control-chart-item layout-item"
        draggable="true"
        (dragstart)="startDrag(layout, $event)"
      >
        {{ layout.title }}
      </div>

      <!-- <div
        class="control-chart-item layout-item"
        draggable="true"
        (dragstart)="startDrag({ title: 'Header', type: 'header' }, $event)"
      >
        Header
      </div> -->
    </div>
</div>

<dx-popup
  [(visible)]="isSavePopupVisible"
  [width]="800"
  [height]="'auto'"
  [showTitle]="true"
  title="Save Settings"
  [dragEnabled]="true"
  [hideOnOutsideClick]="true">

  <div *dxTemplate="let data of 'content'">
    <div class="popup-form">

      <div class="">
        <label>Dashboard Name</label>
        <dx-text-box
          [(value)]="popupData.dashboardName"
          placeholder="Enter dashboard Name">
        </dx-text-box>
      </div>

      <div class="popup-row">
        <div class="">
          <label>Access Type</label>
          <dx-select-box
            [items]="accessType"
            displayExpr="name"
            valueExpr="value"
            [(value)]="popupData.accessType">
          </dx-select-box>
        </div>

        <div class="">
          <label>Refresh Rate (mins)</label>
          <dx-number-box
            [(value)]="popupData.refreshRate"
            [min]="0"
            [showSpinButtons]="true">
          </dx-number-box>
        </div>
      </div>

      <div class="popup-row">
        <div class="">
          <label>Map Type</label>
          <dx-select-box
            [items]="mapTypes"
            [(value)]="popupData.mapType"
            (onValueChanged)="onMapTypeChanged($event)">
          </dx-select-box>
        </div>

        <!-- Enterprise -->
        <div class="" *ngIf="popupData.mapType">
          <label>Enterprise</label>
          <dx-select-box
            [items]="enterprises"
            displayExpr="EnterPriseName"
            valueExpr="EnterpriseID"
            [(value)]="popupData.enterpriseId"
            (onValueChanged)="onEnterpriseChanged($event)">
          </dx-select-box>
        </div>
      </div>

      <div class="popup-row">
        <!-- Site -->
        <div class="" *ngIf="['Site','Plant','Area','Unit'].includes(popupData.mapType)">
          <label>Site</label>
          <dx-select-box
            [items]="sites"
            displayExpr="SiteName"
            valueExpr="SiteId"
            [(value)]="popupData.siteId"
            (onValueChanged)="onSiteChanged($event)">
          </dx-select-box>
        </div>

        <!-- Plant -->
        <div class="" *ngIf="['Plant','Area','Unit'].includes(popupData.mapType)">
          <label>Plant</label>
          <dx-select-box
            [items]="plants"
            displayExpr="PlantName"
            valueExpr="PlantId"
            [(value)]="popupData.plantId"
            (onValueChanged)="onPlantChanged($event)">
          </dx-select-box>
        </div>
      </div>

      <div class="popup-row">
        <!-- Area -->
        <div class="" *ngIf="['Area','Unit'].includes(popupData.mapType)">
          <label>Area</label>
          <dx-select-box
            [items]="areas"
            displayExpr="AreaName"
            valueExpr="AreaId"
            [(value)]="popupData.areaId"
            (onValueChanged)="onAreaChanged($event)">
          </dx-select-box>
        </div>

        <!-- Unit -->
        <div class="" *ngIf="popupData.mapType === 'Unit'">
          <label>Unit</label>
          <dx-select-box
            [items]="units"
            displayExpr="UnitName"
            valueExpr="UnitId"
            [(value)]="popupData.unitId">
          </dx-select-box>
        </div>
      </div>

      <div class="popup-actions">
        <dx-button
          text="Confirm"
          type="success"
          (onClick)="confirmSave()">
        </dx-button>

        <dx-button
          text="Cancel"
          (onClick)="isSavePopupVisible = false">
        </dx-button>
      </div>
    </div>
  </div>
</dx-popup>